<!DOCTYPE html>
<html>
<head>
    <title>Админ-панель (Календарь)</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        #calendar {
            max-width: 900px;
            margin: 40px auto;
        }
    </style>
</head>
<body>
    <div id='calendar'></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const API_URL = 'https://teh-mir14.onrender.com'; // Ваш API URL

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek', // Или другой вид календаря
                slotMinTime: '09:00:00', // Начало рабочего дня
                slotMaxTime: '20:00:00', // Конец рабочего дня
                locale: 'ru', // Локализация
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'timeGridWeek,timeGridDay' // Кнопки для переключения видов
                },
                events: async function(fetchInfo, successCallback, failureCallback) {
                    try {
                        const response = await fetch(`${API_URL}/admin/bookings`); // Запрос к вашему API
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const bookings = await response.json();

                        const events = bookings.map(booking => {
                            // Преобразование данных для FullCalendar
                            const [hours, minutes] = booking.time.split(':');
                            const startTime = `${booking.date}T${hours}:${minutes}:00`;
                            const endTime = `${booking.date}T${parseInt(hours) + 1}:${minutes}:00`; // Продолжительность 1 час

                            return {
                                id: booking._id,
                                title: `${booking.name} (${booking.vehicleType})`, // Заголовок события
                                start: startTime,
                                end: endTime,
                                extendedProps: {
                                    organization: booking.organization, // Дополнительные данные
                                    phone: booking.phone,
                                    details: booking.details
                                },
                                //color: 'red' //  Можно задать цвет для каждого типа ТС
                            };
                        });
                        successCallback(events); // Передача событий FullCalendar
                    } catch (error) {
                        console.error('Error fetching events:', error);
                        failureCallback(error);
                    }
                },
                eventClick: function(info) {
                    // Обработка клика на событие (например, показ деталей)
                    alert(`Детали бронирования:\n
                           Имя: ${info.event.title}\n
                           Организация: ${info.event.extendedProps.organization}\n
                           Телефон: ${info.event.extendedProps.phone}\n
                           Подробности: ${info.event.extendedProps.details}`);
                },
                // Другие опции FullCalendar (например, для создания/редактирования событий)
            });

            calendar.render();
        });
    </script>
</body>
</html>
